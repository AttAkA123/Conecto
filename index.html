<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Connecto — Вход / Регистрация</title>
<style>
body {margin:0;font-family:'Poppins',sans-serif;background:linear-gradient(135deg,#3a3a3a,#2a2a2a);display:flex;justify-content:center;align-items:center;height:100vh;color:#fff;}
.auth-container {background:rgba(255,255,255,0.05);backdrop-filter:blur(10px);padding:40px;border-radius:20px;box-shadow:0 8px 30px rgba(0,0,0,0.5);width:350px;text-align:center;}
.tabs {display:flex;justify-content:space-around;margin-bottom:20px;}
.tabs button {flex:1;padding:10px;border:none;border-radius:10px;background:rgba(255,255,255,0.2);color:#fff;font-weight:bold;cursor:pointer;transition:0.3s;}
.tabs button.active {background:rgba(255,255,255,0.8);color:#000;}
input {width:100%;padding:12px;margin:10px 0;border-radius:10px;border:none;outline:none;background:rgba(255,255,255,0.1);color:#fff;}
input::placeholder {color:rgba(255,255,255,0.7);}
button[type="submit"] {width:100%;padding:12px;border-radius:10px;border:none;background:rgba(255,255,255,0.8);color:#000;font-weight:bold;cursor:pointer;margin-top:10px;transition:0.3s;}
button[type="submit"]:hover {background:rgba(255,255,255,1);}
.error {color:#ff4d4d;margin-top:10px;}
.hidden {display:none;}
</style>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
</head>
<body>
  <div class="auth-container">
    <div class="tabs">
      <button id="loginTab" class="active">Войти</button>
      <button id="registerTab">Регистрация</button>
    </div>

    <form id="authForm">
      <div id="nameField" class="hidden">
        <input type="text" id="name" placeholder="Имя">
      </div>
      <input type="email" id="email" placeholder="Email" required>
      <input type="password" id="password" placeholder="Пароль" required>
      <button type="submit" id="submitBtn">Войти</button>
      <div class="error" id="error"></div>
    </form>
  </div>

<script>
  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyDW9wSQ8xVTvrgaDzwYrg1v8Jzm5KqrrAU",
    authDomain: "baseuser-82b5d.firebaseapp.com",
    projectId: "baseuser-82b5d",
    storageBucket: "baseuser-82b5d.appspot.com",
    messagingSenderId: "307488509181",
    appId: "1:307488509181:web:50397c7ba445c6e45a8294"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  // Элементы
  const loginTab = document.getElementById('loginTab');
  const registerTab = document.getElementById('registerTab');
  const nameField = document.getElementById('nameField');
  const authForm = document.getElementById('authForm');
  const submitBtn = document.getElementById('submitBtn');
  const errorDiv = document.getElementById('error');

  // Переключение вкладок
  loginTab.addEventListener('click', () => {
    loginTab.classList.add('active');
    registerTab.classList.remove('active');
    nameField.classList.add('hidden');
    submitBtn.textContent = "Войти";
    errorDiv.textContent = "";
  });
  registerTab.addEventListener('click', () => {
    registerTab.classList.add('active');
    loginTab.classList.remove('active');
    nameField.classList.remove('hidden');
    submitBtn.textContent = "Регистрация";
    errorDiv.textContent = "";
  });

  // Функция генерации цифрового ID (6 цифр)
  function generateRandomID() {
    return Math.floor(100000 + Math.random() * 900000);
  }

  // Проверка уникальности ID
  async function getUniqueID() {
    let isUnique = false;
    let newID;
    while (!isUnique) {
      newID = generateRandomID();
      const query = await db.collection('users').where('customID', '==', newID).get();
      if (query.empty) isUnique = true;
    }
    return newID;
  }

  // Обработка формы
  authForm.addEventListener('submit', async (e) => {
    e.preventDefault();
    errorDiv.textContent = "";

    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value;

    if (registerTab.classList.contains('active')) {
      const name = document.getElementById('name').value.trim();
      if (!name || !email || !password) { errorDiv.textContent = "Пожалуйста, заполните все поля!"; return; }

      try {
        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
        const user = userCredential.user;
        await user.updateProfile({ displayName: name });
        const uniqueID = await getUniqueID();

        await db.collection('users').doc(user.uid).set({
          uid: user.uid,
          customID: uniqueID,
          name: name,
          email: email,
          createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });

        authForm.reset();
        window.location.href = "profile.html"; // Переход на профиль

      } catch (error) { errorDiv.textContent = error.message; }

    } else {
      // Вход
      if (!email || !password) { errorDiv.textContent = "Пожалуйста, заполните все поля!"; return; }

      auth.signInWithEmailAndPassword(email, password)
        .then(() => {
          authForm.reset();
          window.location.href = "profile.html"; // Переход на профиль
        })
        .catch((error) => { errorDiv.textContent = error.message; });
    }
  });
</script>
</body>
</html>
